<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />

  <link rel="stylesheet" type="text/css" href="style.css" />

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <title>piMI</title>
</head>

<body>
  <header>
    <picture selectable="false" draggable="false">
      <source selectable="false" draggable="false" srcset="/img/piMI.webp" type="image/webp">
      <source selectable="false" draggable="false" srcset="/img/piMI.png" type="image/png">
      <img selectable="false" draggable="false" src="/img/piMI.png" alt="piMI Logo" />
    </picture>
    <div>
      <canvas id="cpuUsageGraph" aria-label="CPU Usage Graph" role="img">
        <p>Your browser does not support the canvas element for the CPU Usage Graph.</p>
      </canvas>
      <canvas id="ramUsageGraph" aria-label="RAM Usage Graph" role="img">
        <p>Your browser does not support the canvas element for the RAM Usage Graph.</p>
      </canvas>
      <canvas id="netUsageGraph" aria-label="Network Usage Graph" role="img">
        <p>Your browser does not support the canvas element for the Network Usage Graph.</p>
      </canvas>
      <canvas id="dskUsageGraph" aria-label="Disk Usage Graph" role="img">
        <p>Your browser does not support the canvas element for the Disk Usage Graph.</p>
      </canvas>
    </div>
  </header>
  <div id="manage">
    <button onclick="ws.send('short');"> Short Press </button>
    <button onclick="ws.send('long');"> Long Press </button>
    <button onclick="ws.send('reset');"> Reset </button>
  </div>
</body>

<script>
  // Establish WS
  var ws = new WebSocket("ws://" + location.hostname); // Possibly update to wss:// later
  ws.onmessage = function (evt) {
    var list = JSON.parse(evt.data);
    for (var i = 0; i < list.length; i++) {
      console.log(list[i]);
    }
  };



  const cpuUsageGraph = document.getElementById('cpuUsageGraph');

  const cpus = [];
  const threads = 12; // Switch to static int when using off pico
  for (var thread = 0; thread < threads; thread++) {
    cpus.push({
      label: "CPU" + thread,
      data: [],
      fill: true
    });
  }

  new Chart(cpuUsageGraph, {
    type: 'line',
    data: {
      labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10'],
      datasets: cpus
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>

</html>